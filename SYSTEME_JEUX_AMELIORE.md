# üéÆ Syst√®me de jeux am√©lior√© - Blackjack & Quiz

## üìã Vue d'ensemble des modifications

### ‚úÖ Blackjack
- Maximum de 10 tours par partie
- Objectif : Atteindre 500¬£
- Syst√®me de points de fid√©lit√© :
  - **2 points** si 500¬£ atteints en ‚â§ 5 tours
  - **1 point** si 500¬£ atteints en ‚â§ 10 tours
- Synchronisation automatique avec le backend

### ‚úÖ Quiz
- Banque de 50 questions
- 10 questions al√©atoires par partie
- Syst√®me de points de fid√©lit√© :
  - **2 points** si score > 5/10
  - **1 point** si score = 5/10
  - **0 point** si score < 5/10
- Plus de poids par question
- Synchronisation automatique avec le backend

---

## üÉè Blackjack - D√©tails des modifications

### 1. Nouveau syst√®me de tours

```typescript
interface GameState {
  solde: number;
  mise: number;
  victoiresConsecutives: number;
  nombreTours: number;  // ‚Üê NOUVEAU
  pointsFidelite: number;  // ‚Üê NOUVEAU
  // ...
}
```

**Fonctionnement :**
- Compteur de tours initialis√© √† 0
- Incr√©ment√© √† chaque nouvelle mise
- Maximum : 10 tours
- Affichage : `Tours: X/10`

### 2. Syst√®me de points de fid√©lit√©

```typescript
// Si atteint 500¬£ avant 5 tours ‚Üí 2 points
if (nouveauSolde >= 500 && gameState.nombreTours <= 5) {
  pointsFideliteGagnes = 2;
  message += ' üéâ 500¬£ en moins de 5 tours! +2 points de fid√©lit√©!';
}
// Si atteint au moins 500¬£ en 10 tours ‚Üí 1 point
else if (nouveauSolde >= 500 && gameState.nombreTours <= 10) {
  pointsFideliteGagnes = 1;
  message += ' üëç 500¬£ atteints! +1 point de fid√©lit√©!';
}
```

**R√®gles :**
- Objectif : Atteindre 500¬£
- ‚â§ 5 tours = **2 points** üéâ
- 6-10 tours = **1 point** üëç
- > 10 tours ou < 500¬£ = **0 point**
- La partie s'arr√™te automatiquement √† 500¬£

### 3. Synchronisation backend

```typescript
const synchroniserPointsFidelite = async (points: number) => {
  const response = await fetch('http://localhost:8000/api/student/points/add', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      points: points,
      source: 'blackjack'
    })
  });
};
```

**Endpoint attendu :** `POST /api/student/points/add`

**Payload :**
```json
{
  "points": 2,
  "source": "blackjack"
}
```

### 4. Affichage mis √† jour

```jsx
<div className="game-info">
  <div className="info-item">
    <div>Solde</div>
    <div className="info-value">{gameState.solde}‚Ç¨</div>
  </div>
  <div className="info-item">
    <div>Tours</div>
    <div className="info-value">{gameState.nombreTours}/10</div>
  </div>
  <div className="info-item">
    <div>Points Fid√©lit√©</div>
    <div className="info-value">{gameState.pointsFidelite}</div>
  </div>
</div>
```

**Indicateurs visuels :**
- Solde ‚â• 500¬£ ‚Üí Message de succ√®s vert
- Tours ‚â• 5 et solde < 500¬£ ‚Üí Avertissement

---

## üìö Quiz - D√©tails des modifications

### 1. Banque de 50 questions

**Fichier :** `QuizQuestions.ts`

```typescript
export const questionBank: Question[] = [
  // 50 questions sur la cuisine s√©n√©galaise
  {
    id: 1,
    question: "Quel est l'ingr√©dient principal du thi√©boudienne ?",
    options: ["Poulet", "Poisson", "B≈ìuf", "Mouton"],
    correctAnswer: 1
  },
  // ... 49 autres questions
];
```

**Th√®mes couverts :**
- Plats traditionnels (thi√©boudienne, yassa, maf√©, etc.)
- Boissons (bissap, bouye, caf√© Touba, etc.)
- Ingr√©dients et √©pices
- Desserts et accompagnements
- Culture culinaire s√©n√©galaise

### 2. S√©lection al√©atoire de 10 questions

```typescript
export const getRandomQuestions = (count: number = 10): Question[] => {
  const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
};
```

**Utilisation :**
```typescript
const [quizState, setQuizState] = useState<QuizState>(() => ({
  // ...
  questions: getRandomQuestions(10)  // 10 questions al√©atoires
}));
```

**Avantages :**
- Chaque partie est diff√©rente
- 50 questions disponibles
- Seulement 10 questions par partie
- M√©lange al√©atoire √† chaque restart

### 3. Nouveau syst√®me de points

```typescript
// Quiz termin√©, calculer les points
const finalScore = quizState.score + (quizState.isCorrect ? 1 : 0);
let pointsFidelite = 0;

if (finalScore > 5) {
  pointsFidelite = 2;  // Plus de 5/10
} else if (finalScore === 5) {
  pointsFidelite = 1;  // Exactement 5/10
}
```

**R√®gles :**
- Score > 5/10 = **2 points** üéâ
- Score = 5/10 = **1 point** üëç
- Score < 5/10 = **0 point** üìö

**Suppression :**
- ‚ùå Plus de poids par question
- ‚ùå Plus de syst√®me de points cumulatifs
- ‚úÖ Syst√®me simplifi√© bas√© sur le score final

### 4. Synchronisation backend

```typescript
const synchroniserPointsFidelite = async (points: number, score: number) => {
  const response = await fetch('http://localhost:8000/api/student/points/add', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      points: points,
      source: 'quiz',
      score: score
    })
  });
};
```

**Endpoint attendu :** `POST /api/student/points/add`

**Payload :**
```json
{
  "points": 2,
  "source": "quiz",
  "score": 7
}
```

### 5. Affichage mis √† jour

**Pendant le quiz :**
```jsx
<span className="current-score">
  Score: {quizState.score}/10
</span>
```

**√âcran de fin :**
```jsx
<div className="score-item highlight">
  <span className="score-label">Points de fid√©lit√© gagn√©s</span>
  <span className="score-value">+{pointsFidelite} pts</span>
</div>

<div className="completion-message">
  {quizState.score > 5 && "Excellent ! +2 points üåü"}
  {quizState.score === 5 && "Bien jou√© ! +1 point üë®‚Äçüç≥"}
  {quizState.score < 5 && "Pas mal ! Venez go√ªter nos plats ! üçΩÔ∏è"}
</div>
```

---

## üîå Backend - Routes √† cr√©er

### Route pour ajouter des points

**Fichier :** `routes/api.php`

```php
Route::middleware('auth:sanctum')->group(function () {
    Route::post('/student/points/add', [PointsController::class, 'addPoints']);
});
```

**Controller :** `PointsController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class PointsController extends Controller
{
    public function addPoints(Request $request)
    {
        $request->validate([
            'points' => 'required|integer|min:0',
            'source' => 'required|string|in:blackjack,quiz',
            'score' => 'nullable|integer'
        ]);

        $user = Auth::user();
        
        // Ajouter les points au compte de l'utilisateur
        $user->points_fidelite += $request->points;
        $user->save();

        // Optionnel : Logger l'activit√©
        \Log::info('Points ajout√©s', [
            'user_id' => $user->id,
            'points' => $request->points,
            'source' => $request->source,
            'score' => $request->score,
            'total_points' => $user->points_fidelite
        ]);

        return response()->json([
            'success' => true,
            'message' => 'Points ajout√©s avec succ√®s',
            'total_points' => $user->points_fidelite
        ]);
    }
}
```

**Migration (si n√©cessaire) :**

```php
Schema::table('users', function (Blueprint $table) {
    $table->integer('points_fidelite')->default(0)->after('email');
});
```

---

## üìä Comparaison Avant/Apr√®s

### Blackjack

| Aspect | Avant | Apr√®s |
|--------|-------|-------|
| **Tours** | Illimit√©s | Maximum 10 |
| **Objectif** | Aucun | Atteindre 500¬£ |
| **Points** | Syst√®me complexe avec As | Simple : bas√© sur objectif |
| **R√©compenses** | 3 victoires + As = Triple | 500¬£ en ‚â§5 tours = 2 pts |
| **Fin de partie** | Solde = 0 | Solde = 0 OU 500¬£ OU 10 tours |

### Quiz

| Aspect | Avant | Apr√®s |
|--------|-------|-------|
| **Questions** | 10 fixes | 50 en banque, 10 al√©atoires |
| **Poids** | 2-3 points par question | Aucun poids |
| **R√©compenses** | Points cumulatifs | Bas√© sur score final |
| **Calcul** | Somme des points | > 5 = 2pts, = 5 = 1pt |
| **Vari√©t√©** | Toujours les m√™mes | Diff√©rent √† chaque partie |

---

## üß™ Tests recommand√©s

### Blackjack

**Test 1 : Gagner 2 points**
1. Jouer et atteindre 500¬£ en 5 tours ou moins
2. V√©rifier le message "+2 points de fid√©lit√©"
3. V√©rifier la synchronisation backend

**Test 2 : Gagner 1 point**
1. Jouer et atteindre 500¬£ entre 6 et 10 tours
2. V√©rifier le message "+1 point de fid√©lit√©"
3. V√©rifier la synchronisation backend

**Test 3 : Maximum de tours**
1. Jouer 10 tours sans atteindre 500¬£
2. V√©rifier que le 11√®me tour est bloqu√©
3. V√©rifier le message "Maximum de 10 tours atteint"

### Quiz

**Test 1 : Gagner 2 points**
1. R√©pondre correctement √† 6+ questions
2. V√©rifier "+2 points de fid√©lit√©"
3. V√©rifier la synchronisation backend

**Test 2 : Gagner 1 point**
1. R√©pondre correctement √† exactement 5 questions
2. V√©rifier "+1 point de fid√©lit√©"
3. V√©rifier la synchronisation backend

**Test 3 : Questions al√©atoires**
1. Terminer un quiz
2. Cliquer sur "Recommencer"
3. V√©rifier que les questions sont diff√©rentes

---

## üìù Fichiers modifi√©s

### Frontend

1. **Blackjack.tsx**
   - Ajout de `nombreTours` et `pointsFidelite` au state
   - Logique de limitation √† 10 tours
   - Nouveau syst√®me de points de fid√©lit√©
   - Fonction de synchronisation backend
   - Affichage mis √† jour

2. **QuizQuestions.ts** (NOUVEAU)
   - Banque de 50 questions
   - Fonction `getRandomQuestions()`

3. **CulinaryQuiz.tsx**
   - Import de `QuizQuestions`
   - S√©lection de 10 questions al√©atoires
   - Suppression du syst√®me de poids
   - Nouveau calcul de points de fid√©lit√©
   - Fonction de synchronisation backend
   - Affichage mis √† jour

### Backend (√† cr√©er)

1. **PointsController.php**
   - M√©thode `addPoints()`
   - Validation des donn√©es
   - Mise √† jour des points utilisateur

2. **routes/api.php**
   - Route `POST /api/student/points/add`

3. **Migration** (si n√©cessaire)
   - Ajout colonne `points_fidelite` dans `users`

---

## ‚úÖ Checklist de d√©ploiement

### Frontend
- [x] Blackjack : Syst√®me de tours impl√©ment√©
- [x] Blackjack : Objectif 500¬£ impl√©ment√©
- [x] Blackjack : Points de fid√©lit√© impl√©ment√©s
- [x] Blackjack : Synchronisation backend impl√©ment√©e
- [x] Quiz : Banque de 50 questions cr√©√©e
- [x] Quiz : S√©lection al√©atoire impl√©ment√©e
- [x] Quiz : Nouveau syst√®me de points impl√©ment√©
- [x] Quiz : Synchronisation backend impl√©ment√©e

### Backend
- [ ] Route `/api/student/points/add` cr√©√©e
- [ ] Controller `PointsController` cr√©√©
- [ ] Migration `points_fidelite` ex√©cut√©e
- [ ] Tests API effectu√©s

### Tests
- [ ] Blackjack : Test 2 points
- [ ] Blackjack : Test 1 point
- [ ] Blackjack : Test maximum tours
- [ ] Quiz : Test 2 points
- [ ] Quiz : Test 1 point
- [ ] Quiz : Test questions al√©atoires

---

## üéØ R√©sum√©

**Blackjack :**
- ‚úÖ Maximum 10 tours
- ‚úÖ Objectif : 500¬£
- ‚úÖ 2 points si ‚â§ 5 tours
- ‚úÖ 1 point si ‚â§ 10 tours
- ‚úÖ Synchronisation backend

**Quiz :**
- ‚úÖ 50 questions en banque
- ‚úÖ 10 questions al√©atoires par partie
- ‚úÖ 2 points si > 5/10
- ‚úÖ 1 point si = 5/10
- ‚úÖ Plus de poids par question
- ‚úÖ Synchronisation backend

**Les deux jeux sont maintenant synchronis√©s avec le backend ! üéâ**
